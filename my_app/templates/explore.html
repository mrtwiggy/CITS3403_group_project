{% extends "base.html" %}

{% block title %}BobaBoard - Explore{% endblock %}

{% block content %}
<main class="w-full px-4 sm:px-6 lg:px-8">
    <div class="flex gap-6">
        <!-- Left Sidebar -->
        <div class="w-80 flex-shrink-0">
            <!-- Search Section -->
            <div class="bg-white rounded-2xl shadow-md p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4">Find Users</h3>
                <div class="relative">
                    <input type="text" 
                           id="user-search" 
                           placeholder="Search by username..." 
                           class="w-full p-2 pl-10 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500">
                    <svg class="w-5 h-5 text-gray-400 absolute left-3 top-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                </div>
                <div id="search-results" class="mt-4 space-y-2">
                    <!-- Search results will be populated here -->
                </div>
            </div>

            <!-- Trending Section -->
            <div class="bg-white rounded-2xl shadow-md p-6">
                <h3 class="text-lg font-semibold mb-4">Trending</h3>
                <div class="space-y-4">
                    <!-- Most Liked Review -->
                    <div class="border-b pb-4">
                        <h4 class="font-medium text-pink-600 mb-2">Most Liked Review</h4>
                        <p class="text-sm text-gray-600 mb-2">"The brown sugar boba here is absolutely amazing! Perfect texture and sweetness."</p>
                        <div class="flex items-center text-sm text-gray-500">
                            <span class="mr-2">üëç 128</span>
                            <span>by @bobaLover</span>
                        </div>
                    </div>
                    <!-- Recent Review -->
                    <div>
                        <h4 class="font-medium text-pink-600 mb-2">Recent Review</h4>
                        <p class="text-sm text-gray-600 mb-2">"Tried their new taro milk tea with boba. The flavor was rich and creamy!"</p>
                        <div class="flex items-center text-sm text-gray-500">
                            <span class="mr-2">üëç 45</span>
                            <span>by @teaEnthusiast</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Leaderboard -->
        <div class="flex-grow">
            <div class="bg-white rounded-2xl shadow-md p-6">
                <!-- Leaderboard Header with Toggle -->
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold">Boba Leaderboard</h2>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm font-medium text-gray-700" id="public-label">Public</span>
                        <button type="button" id="view-toggle" class="relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-offset-2 bg-gray-200" role="switch" aria-checked="false">
                            <span class="translate-x-0 pointer-events-none relative inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out" id="toggle-slider"></span>
                        </button>
                        <span class="text-sm font-medium text-gray-700" id="friends-label">Friends</span>
                    </div>
                </div>

                <!-- Header Row -->
                <div class="grid grid-cols-12 gap-1 font-semibold mb-4 pb-2 border-b">
                    <div class="col-span-1 text-center">Rank</div>
                    <div class="col-span-2">User</div>
                    <div class="col-span-3">Favourite Store</div>
                    <div class="col-span-2 text-center">Total Bobas</div>
                    <div class="col-span-2 text-center">This Week</div>
                    <div class="col-span-2 text-center">Streak</div>
                </div>

                <!-- Skeleton Rows -->
                <div class="space-y-4" id="leaderboard-content">
                    <!-- Row 1 -->
                    <div class="grid grid-cols-12 gap-1 items-center p-2">
                        <div class="col-span-1 font-bold text-2xl text-center">1</div>
                        <div class="col-span-2 flex items-center">
                            <div class="w-10 h-10 bg-gray-200 rounded-full"></div>
                            <span class="ml-2">Loading...</span>
                        </div>
                        <div class="col-span-3">Loading...</div>
                        <div class="col-span-2 text-center">-</div>
                        <div class="col-span-2 text-center">-</div>
                        <div class="col-span-2 text-center">-</div>
                    </div>

                    <!-- Row 2 -->
                    <div class="grid grid-cols-12 gap-1 items-center p-2">
                        <div class="col-span-1 font-bold text-2xl text-center">2</div>
                        <div class="col-span-2 flex items-center">
                            <div class="w-10 h-10 bg-gray-200 rounded-full"></div>
                            <span class="ml-2">Loading...</span>
                        </div>
                        <div class="col-span-3">Loading...</div>
                        <div class="col-span-2 text-center">-</div>
                        <div class="col-span-2 text-center">-</div>
                        <div class="col-span-2 text-center">-</div>
                    </div>

                    <!-- Row 3 -->
                    <div class="grid grid-cols-12 gap-1 items-center p-2">
                        <div class="col-span-1 font-bold text-2xl text-center">3</div>
                        <div class="col-span-2 flex items-center">
                            <div class="w-10 h-10 bg-gray-200 rounded-full"></div>
                            <span class="ml-2">Loading...</span>
                        </div>
                        <div class="col-span-3">Loading...</div>
                        <div class="col-span-2 text-center">-</div>
                        <div class="col-span-2 text-center">-</div>
                        <div class="col-span-2 text-center">-</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const toggle = document.getElementById('view-toggle');
        const slider = document.getElementById('toggle-slider');
        const publicLabel = document.getElementById('public-label');
        const friendsLabel = document.getElementById('friends-label');
        const leaderboardContent = document.getElementById('leaderboard-content');
        const userSearch = document.getElementById('user-search');
        const searchResults = document.getElementById('search-results');
        let isFriends = false;

        function updateView(newState) {
            isFriends = newState;
            
            // Update toggle appearance
            if (isFriends) {
                toggle.classList.remove('bg-gray-200');
                toggle.classList.add('bg-pink-400');
                slider.classList.remove('translate-x-0');
                slider.classList.add('translate-x-5');
            } else {
                toggle.classList.add('bg-gray-200');
                toggle.classList.remove('bg-pink-400');
                slider.classList.add('translate-x-0');
                slider.classList.remove('translate-x-5');
            }

            // Update label colors
            publicLabel.classList.toggle('text-gray-700', !isFriends);
            publicLabel.classList.toggle('text-pink-500', isFriends);
            friendsLabel.classList.toggle('text-gray-700', isFriends);
            friendsLabel.classList.toggle('text-pink-500', !isFriends);

            // Add loading state to leaderboard
            leaderboardContent.classList.add('opacity-50');
            
            // Simulate loading (this will be replaced with actual data loading later)
            setTimeout(() => {
                leaderboardContent.classList.remove('opacity-50');
                console.log('View toggled:', isFriends ? 'Friends' : 'Public');
            }, 300);
        }

        toggle.addEventListener('click', function() {
            updateView(!isFriends);
        });

        // User search functionality
        userSearch.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            if (searchTerm.length < 2) {
                searchResults.innerHTML = '';
                return;
            }

            // Simulate search results (replace with actual API call later)
            const mockResults = [
                { username: 'bobaLover', avatar: 'pfp1.png' },
                { username: 'teaEnthusiast', avatar: 'pfp2.png' },
                { username: 'bubbleTeaFan', avatar: 'pfp3.png' }
            ].filter(user => user.username.toLowerCase().includes(searchTerm));

            searchResults.innerHTML = mockResults.map(user => `
                <div class="flex items-center p-2 hover:bg-gray-50 rounded-lg cursor-pointer">
                    <img src="{{ url_for('static', filename='images/${user.avatar}') }}" 
                         alt="${user.username}" 
                         class="w-8 h-8 rounded-full mr-2">
                    <span class="text-sm">@${user.username}</span>
                </div>
            `).join('');
        });

        // Initialize the view
        updateView(false);
    });
</script>
{% endblock %} 